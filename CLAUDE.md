# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Goblin is a toy programming language that transpiles to Go code. Source files (`.goblin`) are parsed into an AST and then converted to Go source code using the jennifer code generation library.

## Development Commands

### Building and Running
- `go build ./command/goblin` - Build the goblin compiler
- `goblin <file.goblin>` - Transpile Goblin source to Go (outputs to stdout)
- Typical workflow: `goblin hello.goblin > hello.go && go run hello.go`

### Grammar Generation
- `gocc -a goblin.bnf` - Regenerate lexer, parser, token, errors, and util packages from BNF grammar

### Testing
- `go test ./...` - Run all tests
- `go test -v -run TestExamples/hello ./examples` - Run a single example test by name
- Tests live in `examples/examples_test.go` — each `.goblin` file is transpiled, compiled, executed, and its output compared against corresponding `.stdout` and `.stderr` files
- On first run, missing `.stdout`/`.stderr` files are auto-created from actual output

## Architecture

### Code Generation Flow

```
source.goblin → Lexer (lexer/) → Tokens → Parser (parser/) → AST (ast/) → Transpiler (transpiler/) → Go source code
```

The transpiler wraps all generated code inside an `Execute()` function and a `main()` that calls it. Runtime values use the `object.Object` interface so arithmetic and logic operations are dispatched dynamically via method calls (`.Add()`, `.Multiply()`, `.And()`, etc.).

### Key Source Files (hand-written)

- `goblin.bnf` — Master grammar. All changes to syntax start here.
- `ast/ast.go` — AST node types and `New*`/`Append*` constructors required by gocc reduce actions.
- `transpiler/transpiler.go` — Walks the AST and emits Go code via jennifer. Built-in functions (`print`, `range`) are resolved here.
- `object/*.go` — Runtime type system: Integer (int64), Float (float64), String, Bool, List, Unit (nil), Error. Each type implements the `Object` interface for arithmetic, logic, and iteration.
- `builtin/builtin.go` — Built-in function implementations. Signature: `func([]Object, map[string]Object) (Object, error)`.
- `command/goblin/goblin.go` — CLI entry point. Also contains a hardcoded `hello` AST variable useful for testing the transpiler without parsing.

### Generated Code (do not edit)

The `lexer/`, `parser/`, `token/`, `errors/`, and `util/` packages are auto-generated by `gocc goblin.bnf`. Edit the BNF grammar and regenerate instead.

### Adding New Language Features

1. Update `goblin.bnf` with new grammar rules
2. Run `gocc goblin.bnf` to regenerate parser components
3. Add AST node types and gocc constructor functions in `ast/ast.go`
4. Implement transpilation in `transpiler/transpiler.go`
5. If the feature needs a new runtime type, add it in `object/`
6. Add an example `.goblin` file under `examples/` and run tests to generate expected output

## Key Dependencies

- `github.com/dave/jennifer/jen` — Go code generation library
- `gocc` (external CLI tool) — Parser/lexer generator from BNF grammar

## Git Commit Convention

- Using gitmoji in commit message
